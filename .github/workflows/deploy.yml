name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Check secrets
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤:"
          if [ -z "$BOT_TOKEN" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            exit 1
          else
            echo "‚úÖ TELEGRAM_BOT_TOKEN: ${BOT_TOKEN:0:10}..."
          fi
          
          if [ -z "$CHAT_ID" ]; then
            echo "‚ùå –û–®–ò–ë–ö–ê: TELEGRAM_CHAT_ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            exit 1
          else
            echo "‚úÖ TELEGRAM_CHAT_ID: $CHAT_ID"
          fi
      
      - name: Replace tokens
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "üîß –ó–∞–º–µ–Ω—è—é –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã..."
          
          # –ó–∞–º–µ–Ω—è–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
          sed -i "s|TELEGRAM_BOT_TOKEN_PLACEHOLDER|$BOT_TOKEN|g" forms.html
          
          # –ó–∞–º–µ–Ω—è–µ–º chat_id (—É—á–∏—Ç—ã–≤–∞–µ–º –∫–∞–≤—ã—á–∫–∏)
          sed -i "s|\"TELEGRAM_CHAT_ID_PLACEHOLDER\"|\"$CHAT_ID\"|g" forms.html
          
          echo "‚úÖ –ó–∞–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞:"
          grep -n "BOT_TOKEN\|ADMIN_IDS" forms.html
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages
          force_orphan: true
